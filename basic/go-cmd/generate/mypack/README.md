
在generate注释中使用go run 可以在源码中定义生成器。生成器只是一个小的 Go 程序（在包 main 中）。唯一需要注意的是 //go:build 约束，它告诉 Go 工具链在构建项目时忽略这个文件。事实上，gen.go 不是包的一部分；它位于 main 包中，旨在与 go generate 一起运行，而不是编译到包中。

典型的模式是代码生成涉及 3 个文件，它们都共存于同一个目录/包中：

源文件包含一些包的代码，以及一条神奇的注释，用于调用带有 go run 的生成器。
generator，它是一个单一的包含 package main 的 .go 文件; 该生成器由源文件中的魔术注释中的 go run 调用以生成生成的文件。生成器 .go 文件通常会有一个 //go:build ignore 约束，以将其从包本身的构建中排除。
generated file 由 generator 生成; 在某些约定中，它与源文件具有相同的名称，但后跟_gen（如 pack.go --> pack_gen.go）；或者它可能是某种前缀（如 gen）。生成文件中的代码与源文件中的代码在同一个包中。在许多情况下，生成的文件包含一些未导出符号的实现细节；源文件可以在其代码中引用这一点，因为这两个文件位于同一个包中。
当然，这些都不是工具所要求的——它只是描述了一个通用的约定；特定的项目可以以不同的方式设置（例如，一个生成器为多个包生成代码）。